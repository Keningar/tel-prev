/**
 * @author Alex Arreaga <atarreaga@telconet.ec>
 * @version 1.0
 * @since 18-03-2020    
 * Se crea DML para reversar configuraciones al Banco Guayaquil.
 */

--SE ELIMINA ASOCIACIÓN DE CARACTERÍSTICA 'MENSAJE_OK' A 'CUENTA BANCO GUAYAQUIL'.
DELETE FROM DB_FINANCIERO.ADMI_FORMATO_DEBITO_CARACT 
WHERE BANCO_TIPO_CUENTA_ID =
  (
  SELECT BANCO_TIPO_CUENTA_ID 
  FROM DB_FINANCIERO.ADMI_GRUPO_ARCHIVO_DEBITO_CAB 
  WHERE NOMBRE_GRUPO = 'Cuentas Banco Guayaquil' 
  AND EMPRESA_COD    = 18 
  AND ESTADO         = 'Activo'
  ) 
AND EMPRESA_COD = 18
AND CARACTERISTICA_ID = 
  (
  SELECT ID_CARACTERISTICA
  FROM DB_COMERCIAL.ADMI_CARACTERISTICA 
  WHERE DESCRIPCION_CARACTERISTICA = 'MENSAJE_OK'
  AND ESTADO             	   = 'Activo'
  AND TIPO                         = 'FINANCIERO'
  )
AND PROCESO = 'SUBIDA'
AND ESTADO  = 'Activo';

--SE ELIMINA CARACTERÍSTICA 'MENSAJE_OK'
DELETE FROM DB_COMERCIAL.ADMI_CARACTERISTICA 
WHERE DESCRIPCION_CARACTERISTICA = 'MENSAJE_OK' 
AND ESTADO = 'Activo' 
AND TIPO   = 'FINANCIERO';


--SE ELIMINA ASOCIACIÓN DE CARACTERÍSTICA 'MENSAJE_PARCIAL_EXITOSO' A 'CUENTA BANCO GUAYAQUIL'.
DELETE FROM DB_FINANCIERO.ADMI_FORMATO_DEBITO_CARACT 
WHERE BANCO_TIPO_CUENTA_ID =
  (
  SELECT BANCO_TIPO_CUENTA_ID 
  FROM DB_FINANCIERO.ADMI_GRUPO_ARCHIVO_DEBITO_CAB 
  WHERE NOMBRE_GRUPO = 'Cuentas Banco Guayaquil' 
  AND EMPRESA_COD    = 18 
  AND ESTADO         = 'Activo'
  ) 
AND EMPRESA_COD = 18
AND CARACTERISTICA_ID = 
  (
  SELECT ID_CARACTERISTICA
  FROM DB_COMERCIAL.ADMI_CARACTERISTICA 
  WHERE DESCRIPCION_CARACTERISTICA = 'MENSAJE_PARCIAL_EXITOSO'
  AND ESTADO             	   = 'Activo'
  AND TIPO                         = 'FINANCIERO'
  )
AND PROCESO = 'SUBIDA'
AND ESTADO  = 'Activo';


--SE ELIMINA CARACTERÍSTICA 'MENSAJE_PARCIAL_EXITOSO'
DELETE FROM DB_COMERCIAL.ADMI_CARACTERISTICA 
WHERE DESCRIPCION_CARACTERISTICA = 'MENSAJE_PARCIAL_EXITOSO' 
AND ESTADO = 'Activo' 
AND TIPO   = 'FINANCIERO';


DELETE FROM DB_GENERAL.ADMI_PARAMETRO_DET
WHERE PARAMETRO_ID = 
  (
  SELECT ID_PARAMETRO 
  FROM DB_GENERAL.ADMI_PARAMETRO_CAB 
  WHERE NOMBRE_PARAMETRO = 'CODIGOS_RESULTADO_BANCO_GUAYAQUIL'
  AND MODULO             = 'FINANCIERO'
  AND PROCESO            = 'DEBITOS'
  AND ESTADO             = 'Activo' 
  )
AND DESCRIPCION IN 
(
  (
   SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Debito en cuenta exitoso'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Saldo insuficiente'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Cuenta inactiva'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Registro Cancelado'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Proceso incompleto'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Cuenta Cancelada o cerrada'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Débito no autorizado'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Transferencia sin cupo'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'En tránsito Transacción Interbancaria'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Registro eliminado'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Error tipo de cuenta y relación'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Cuenta no existe'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Tipo de cuenta invalida'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Registro reversado'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Proceso pendiente de ejecución'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Debito Parcial exitoso'
  ),
  (
  SELECT DESCRIPCION FROM DB_GENERAL.ADMI_PARAMETRO_DET WHERE DESCRIPCION = 'Error técnico o indeterminado'
  )
);

--SE ELIMINA CABECERA PARAMETRO DE 'CODIGOS_RESULTADO_BANCO_GUAYAQUIL'
DELETE FROM DB_GENERAL.ADMI_PARAMETRO_CAB
WHERE NOMBRE_PARAMETRO = 'CODIGOS_RESULTADO_BANCO_GUAYAQUIL'
AND DESCRIPCION        = 'CONTIENE LOS CÓDIGOS DE RESULTADO DEL PROCESO DE DÉBITOS PARA GUAYAQUIL'
AND MODULO             = 'FINANCIERO'
AND PROCESO            = 'DEBITOS'
AND ESTADO             = 'Activo';

--SE INACTIVA Y ACTUALIZA EL VALOR DE CANTIDAD DE LINEAS PARA BANCO GYE
UPDATE DB_FINANCIERO.ADMI_FORMATO_DEBITO_CARACT 
SET VALOR = '10000', ESTADO = 'Inactivo'
WHERE banco_tipo_cuenta_id = 
(
	SELECT ABTC.ID_BANCO_TIPO_CUENTA
	FROM DB_FINANCIERO.ADMI_BANCO_TIPO_CUENTA ABTC,
	  DB_FINANCIERO.ADMI_BANCO AB,
	  DB_FINANCIERO.ADMI_TIPO_CUENTA ATC
	WHERE ABTC.BANCO_ID        = AB.ID_BANCO
	AND ABTC.TIPO_CUENTA_ID    = ATC.ID_TIPO_CUENTA
	AND ATC.DESCRIPCION_CUENTA = 'AHORRO'
	AND ATC.ESTADO             = 'Activo'
	AND AB.DESCRIPCION_BANCO   = 'BANCO GUAYAQUIL'
	AND AB.ESTADO              = 'Activo'
)
AND EMPRESA_COD = 18
AND PROCESO     = 'ENVIO';

--SE ELIMINA ASOCIACIÓN DE CARACTERÍSTICA 'LECTURA_PARCIALES_TXT' A 'CUENTA BANCO GUAYAQUIL'.
DELETE FROM DB_FINANCIERO.ADMI_FORMATO_DEBITO_CARACT 
WHERE BANCO_TIPO_CUENTA_ID =
  (
  SELECT BANCO_TIPO_CUENTA_ID 
  FROM DB_FINANCIERO.ADMI_GRUPO_ARCHIVO_DEBITO_CAB 
  WHERE NOMBRE_GRUPO = 'Cuentas Banco Guayaquil' 
  AND EMPRESA_COD    = 18 
  AND ESTADO         = 'Activo'
  )
AND EMPRESA_COD = 18
AND CARACTERISTICA_ID = 
  (
  SELECT ID_CARACTERISTICA
  FROM DB_COMERCIAL.ADMI_CARACTERISTICA 
  WHERE DESCRIPCION_CARACTERISTICA = 'LECTURA_PARCIALES_TXT'
  AND ESTADO             	   = 'Activo'
  AND TIPO                         = 'FINANCIERO'
  )
AND PROCESO = 'SUBIDA'
AND ESTADO  = 'Activo';

--SE ELIMINA CARACTERÍSTICA 'LECTURA_PARCIALES_TXT'
DELETE FROM DB_COMERCIAL.ADMI_CARACTERISTICA 
WHERE DESCRIPCION_CARACTERISTICA = 'LECTURA_PARCIALES_TXT' 
AND ESTADO = 'Activo' 
AND TIPO   = 'FINANCIERO';

--SE ELIMINA PARAMETRO 'CONSTANTE_FORMATO_CUENTA'
DELETE FROM DB_GENERAL.ADMI_PARAMETRO_DET
WHERE PARAMETRO_ID = 
(
  SELECT ID_PARAMETRO 
  FROM DB_GENERAL.ADMI_PARAMETRO_CAB 
  WHERE NOMBRE_PARAMETRO = 'CONSTANTE_FORMATO_CUENTA'
    AND MODULO           = 'FINANCIERO'
    AND ESTADO           = 'Activo' 
);
  
DELETE FROM DB_GENERAL.ADMI_PARAMETRO_CAB
WHERE NOMBRE_PARAMETRO = 'CONSTANTE_FORMATO_CUENTA'
AND MODULO             = 'FINANCIERO'
AND ESTADO             = 'Activo'; 
 
COMMIT;
/
