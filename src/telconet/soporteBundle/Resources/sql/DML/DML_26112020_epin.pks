INSERT INTO DB_GENERAL.ADMI_PARAMETRO_CAB 
VALUES (DB_GENERAL.SEQ_ADMI_PARAMETRO_CAB.NEXTVAL, 'QUERYS FIBRA SOPORTE', 'QUERYS DINAMICOS PARA LA OBTENCION DE LA FIBRA UTILIZADA EN TAREAS', 'SOPORTE', 'SOPORTE', 'Activo', 'epin', sysdate, '127.0.0.1', NULL, NULL, NULL);

INSERT INTO DB_GENERAL.ADMI_PARAMETRO_DET 
values(DB_GENERAL.SEQ_ADMI_PARAMETRO_DET.NEXTVAL, (SELECT ID_PARAMETRO
                                                   FROM DB_GENERAL.ADMI_PARAMETRO_CAB 
                                                   WHERE NOMBRE_PARAMETRO = 'QUERYS FIBRA SOPORTE'),
'INSTALACION', 
'SELECT ICOM.ID_COMUNICACION, ICOM.DETALLE_ID,ipu.PERSONA_EMPRESA_ROL_ID, ipu.LOGIN, ICOM.FECHA_COMUNICACION, 
        ICOM.REMITENTE_NOMBRE, IDH.FE_CREACION FECHA_FINALIZACION, AT.DESCRIPCION_TAREA
  FROM DB_SOPORTE.INFO_COMUNICACION ICOM,
      DB_SOPORTE.INFO_DETALLE IDT,
      DB_SOPORTE.INFO_DETALLE_HISTORIAL IDH,
      DB_COMERCIAL.INFO_DETALLE_SOLICITUD ids,
      DB_COMERCIAL.INFO_SERVICIO iser,
      DB_COMERCIAL.INFO_PUNTO ipu,
      DB_SOPORTE.ADMI_TAREA at
WHERE AT.ID_TAREA = IDT.TAREA_ID
AND ICOM.DETALLE_ID = IDT.ID_DETALLE
AND ids.TIPO_SOLICITUD_ID IN(6,8,13,140)
AND IDH.DETALLE_ID=IDT.ID_DETALLE
AND IDH.ESTADO=' || '''Finalizada' || '''
AND ids.ID_DETALLE_SOLICITUD = IDT.DETALLE_SOLICITUD_ID
AND iser.ID_SERVICIO = ids.SERVICIO_ID
and ipu.ID_PUNTO = iser.PUNTO_ID
AND ICOM.DETALLE_ID = <<detalle_id>>
ORDER BY 1 DESC;'
, 'DETALLE', NULL, NULL, 'Activo', 'epin', sysdate, '127.0.0.1', NULL, NULL, NULL, NULL, '18', NULL, NULL, NULL);

INSERT INTO DB_GENERAL.ADMI_PARAMETRO_DET 
values(DB_GENERAL.SEQ_ADMI_PARAMETRO_DET.NEXTVAL, (SELECT ID_PARAMETRO
                                                   FROM DB_GENERAL.ADMI_PARAMETRO_CAB 
                                                   WHERE NOMBRE_PARAMETRO = 'QUERYS FIBRA SOPORTE'),
'INSTALACION', 
'SELECT ICOM.ID_COMUNICACION, ICOM.DETALLE_ID,ipu.PERSONA_EMPRESA_ROL_ID, ipu.LOGIN, ICOM.FECHA_COMUNICACION, 
        ICOM.REMITENTE_NOMBRE, IDH.FE_CREACION FECHA_FINALIZACION, AT.DESCRIPCION_TAREA
  FROM DB_SOPORTE.INFO_COMUNICACION ICOM,
      DB_SOPORTE.INFO_DETALLE IDT,
      DB_SOPORTE.INFO_DETALLE_HISTORIAL IDH,
      DB_COMERCIAL.INFO_DETALLE_SOLICITUD ids,
      DB_COMERCIAL.INFO_SERVICIO iser,
      DB_COMERCIAL.INFO_PUNTO ipu,
      DB_SOPORTE.ADMI_TAREA at
WHERE AT.ID_TAREA = IDT.TAREA_ID
AND ICOM.DETALLE_ID = IDT.ID_DETALLE
AND ids.TIPO_SOLICITUD_ID IN(6,8,13,140)
AND IDH.DETALLE_ID=IDT.ID_DETALLE
AND IDH.ESTADO=' || '''Finalizada' || '''
AND ids.ID_DETALLE_SOLICITUD = IDT.DETALLE_SOLICITUD_ID
AND iser.ID_SERVICIO = ids.SERVICIO_ID
and ipu.ID_PUNTO = iser.PUNTO_ID
AND ICOM.ID_COMUNICACION = <<comunicacion_id>>
ORDER BY 1 DESC;'
, 'COMUNICACION', NULL, NULL, 'Activo', 'epin', sysdate, '127.0.0.1', NULL, NULL, NULL, NULL, '18', NULL, NULL, NULL);

INSERT INTO DB_GENERAL.ADMI_PARAMETRO_DET 
values(DB_GENERAL.SEQ_ADMI_PARAMETRO_DET.NEXTVAL, (SELECT ID_PARAMETRO
                                                   FROM DB_GENERAL.ADMI_PARAMETRO_CAB 
                                                   WHERE NOMBRE_PARAMETRO = 'QUERYS FIBRA SOPORTE'),
'SOPORTE', 
'   SELECT ico.ID_COMUNICACION, ico.DETALLE_ID, ipu.PERSONA_EMPRESA_ROL_ID, ipu.LOGIN, ico.FECHA_COMUNICACION,
     ico.REMITENTE_NOMBRE, IDH.FE_CREACION FECHA_FINALIZACION,
           AT.DESCRIPCION_TAREA
    FROM DB_SOPORTE.INFO_DETALLE ID1 ,
        DB_SOPORTE.INFO_DETALLE ID2 ,
        DB_SOPORTE.INFO_PARTE_AFECTADA ipa,
        DB_COMUNICACION.INFO_COMUNICACION ico,
        DB_COMERCIAL.INFO_PUNTO ipu
        ,DB_SOPORTE.INFO_DETALLE_HISTORIAL IDH,
        DB_SOPORTE.ADMI_TAREA at
    WHERE 
      ico.CASO_ID IS not  NULL
      AND IDH.DETALLE_ID=ID1.ID_DETALLE
      AND IDH.ESTADO=' || '''Finalizada' || '''
    AND ID1.ID_DETALLE = ico.DETALLE_ID
    AND ID1.DETALLE_HIPOTESIS_ID = ID2.DETALLE_HIPOTESIS_ID
    AND ipa.DETALLE_ID = ID2.ID_DETALLE
    AND ipu.ID_PUNTO = ipa.AFECTADO_ID
    and AT.ID_TAREA = ID1.TAREA_ID
    and ico.DETALLE_ID = <<detalle_id>>
    AND ipa.TIPO_AFECTADO=' || '''Cliente' || ''';
'
, 'DETALLE', NULL, NULL, 'Activo', 'epin', sysdate, '127.0.0.1', NULL, NULL, NULL, NULL, '18', NULL, NULL, NULL);

INSERT INTO DB_GENERAL.ADMI_PARAMETRO_DET 
values(DB_GENERAL.SEQ_ADMI_PARAMETRO_DET.NEXTVAL, (SELECT ID_PARAMETRO
                                                   FROM DB_GENERAL.ADMI_PARAMETRO_CAB 
                                                   WHERE NOMBRE_PARAMETRO = 'QUERYS FIBRA SOPORTE'),
'SOPORTE', 
'SELECT ico.ID_COMUNICACION, ico.DETALLE_ID, ipu.PERSONA_EMPRESA_ROL_ID, ipu.LOGIN, ico.FECHA_COMUNICACION,
     ico.REMITENTE_NOMBRE, IDH.FE_CREACION FECHA_FINALIZACION,
          AT.DESCRIPCION_TAREA
    FROM DB_SOPORTE.INFO_DETALLE ID1 ,
        DB_SOPORTE.INFO_DETALLE ID2 ,
        DB_SOPORTE.INFO_PARTE_AFECTADA ipa,
        DB_COMUNICACION.INFO_COMUNICACION ico,
        DB_COMERCIAL.INFO_PUNTO ipu
        ,DB_SOPORTE.INFO_DETALLE_HISTORIAL IDH,
        DB_SOPORTE.ADMI_TAREA at
    WHERE 
      ico.CASO_ID IS not  NULL
      AND IDH.DETALLE_ID=ID1.ID_DETALLE
      AND IDH.ESTADO=' || '''Finalizada' || '''
    AND ID1.ID_DETALLE = ico.DETALLE_ID
    AND ID1.DETALLE_HIPOTESIS_ID = ID2.DETALLE_HIPOTESIS_ID
    AND ipa.DETALLE_ID = ID2.ID_DETALLE
    AND ipu.ID_PUNTO = ipa.AFECTADO_ID
    and AT.ID_TAREA = ID1.TAREA_ID
    and ico.ID_COMUNICACION = <<comunicacion_id>>
    AND ipa.TIPO_AFECTADO=' || '''Cliente' || ''';'
, 'COMUNICACION', NULL, NULL, 'Activo', 'epin', sysdate, '127.0.0.1', NULL, NULL, NULL, NULL, '18', NULL, NULL, NULL);

INSERT INTO DB_GENERAL.ADMI_PARAMETRO_DET 
values(DB_GENERAL.SEQ_ADMI_PARAMETRO_DET.NEXTVAL, (SELECT ID_PARAMETRO
                                                   FROM DB_GENERAL.ADMI_PARAMETRO_CAB 
                                                   WHERE NOMBRE_PARAMETRO = 'QUERYS FIBRA SOPORTE'),
'INTERDEPARTAMENTAL', 
'SELECT ICOM.ID_COMUNICACION, ICOM.DETALLE_ID,ipu.PERSONA_EMPRESA_ROL_ID, ipu.LOGIN, ICOM.FECHA_COMUNICACION,
        ICOM.REMITENTE_NOMBRE,IDH.FE_CREACION FECHA_FINALIZACION, AT.DESCRIPCION_TAREA       
  FROM DB_SOPORTE.INFO_DETALLE_ASIGNACION  IDA,
      DB_SOPORTE.INFO_COMUNICACION ICOM,
      DB_SOPORTE.INFO_DETALLE IDT,
      DB_SOPORTE.INFO_DETALLE_HISTORIAL IDH,
      DB_COMERCIAL.INFO_DETALLE_SOLICITUD ids,
      DB_COMERCIAL.INFO_SERVICIO iser,
      DB_COMERCIAL.INFO_PUNTO ipu,
      DB_SOPORTE.ADMI_TAREA AT,
      DB_COMERCIAL.ADMI_TIPO_SOLICITUD ats
WHERE IDA.DETALLE_ID = IDT.ID_DETALLE
and AT.ID_TAREA = IDT.TAREA_ID
AND ICOM.DETALLE_ID = IDT.ID_DETALLE
AND ids.TIPO_SOLICITUD_ID NOT IN(6,8,9,13,131,140)
and ats.ID_TIPO_SOLICITUD = ids.TIPO_SOLICITUD_ID
AND ICOM.CASO_ID IS NULL
and ICOM.REMITENTE_NOMBRE is not null
AND IDH.DETALLE_ID=IDT.ID_DETALLE
AND IDH.ESTADO=' || '''Finalizada' || '''
AND ids.ID_DETALLE_SOLICITUD = IDT.DETALLE_SOLICITUD_ID
AND iser.ID_SERVICIO = ids.SERVICIO_ID
and ipu.ID_PUNTO = iser.PUNTO_ID
AND ICOM.DETALLE_ID = <<detalle_id>>
ORDER BY 1 DESC;
'
, 'DETALLE', NULL, NULL, 'Activo', 'epin', sysdate, '127.0.0.1', NULL, NULL, NULL, NULL, '18', NULL, NULL, NULL);

INSERT INTO DB_GENERAL.ADMI_PARAMETRO_DET 
values(DB_GENERAL.SEQ_ADMI_PARAMETRO_DET.NEXTVAL, (SELECT ID_PARAMETRO
                                                   FROM DB_GENERAL.ADMI_PARAMETRO_CAB 
                                                   WHERE NOMBRE_PARAMETRO = 'QUERYS FIBRA SOPORTE'),
'INTERDEPARTAMENTAL', 
'SELECT ICOM.ID_COMUNICACION, ICOM.DETALLE_ID,ipu.PERSONA_EMPRESA_ROL_ID, ipu.LOGIN, ICOM.FECHA_COMUNICACION, 
        ICOM.REMITENTE_NOMBRE,IDH.FE_CREACION FECHA_FINALIZACION, AT.DESCRIPCION_TAREA
  FROM DB_SOPORTE.INFO_DETALLE_ASIGNACION  IDA,
      DB_SOPORTE.INFO_COMUNICACION ICOM,
      DB_SOPORTE.INFO_DETALLE IDT,
      DB_SOPORTE.INFO_DETALLE_HISTORIAL IDH,
      DB_COMERCIAL.INFO_DETALLE_SOLICITUD ids,
      DB_COMERCIAL.INFO_SERVICIO iser,
      DB_COMERCIAL.INFO_PUNTO ipu,
      DB_SOPORTE.ADMI_TAREA AT,
      DB_COMERCIAL.ADMI_TIPO_SOLICITUD ats
WHERE IDA.DETALLE_ID = IDT.ID_DETALLE
and AT.ID_TAREA = IDT.TAREA_ID
AND ICOM.DETALLE_ID = IDT.ID_DETALLE
AND ids.TIPO_SOLICITUD_ID NOT IN(6,8,9,13,131,140)
and ats.ID_TIPO_SOLICITUD = ids.TIPO_SOLICITUD_ID
AND ICOM.CASO_ID IS NULL
and ICOM.REMITENTE_NOMBRE is not null
AND IDH.DETALLE_ID=IDT.ID_DETALLE
AND IDH.ESTADO=' || '''Finalizada' || '''
AND ids.ID_DETALLE_SOLICITUD = IDT.DETALLE_SOLICITUD_ID
AND iser.ID_SERVICIO = ids.SERVICIO_ID
and ipu.ID_PUNTO = iser.PUNTO_ID
AND ICOM.ID_COMUNICACION = <<comunicacion_id>>
ORDER BY 1 DESC;
'
, 'COMUNICACION', NULL, NULL, 'Activo', 'epin', sysdate, '127.0.0.1', NULL, NULL, NULL, NULL, '18', NULL, NULL, NULL);

commit;
/

