
--Reverso el detalle para los datos de la tarea de cambio de equipo de los servicios safecity
DELETE DB_GENERAL.ADMI_PARAMETRO_DET
WHERE
    VALOR1 = 'ID_TAREA_CAMBIO_EQUIPO_SERVICIO'
    AND PARAMETRO_ID = ( SELECT ID_PARAMETRO FROM DB_GENERAL.ADMI_PARAMETRO_CAB WHERE NOMBRE_PARAMETRO = 'NUEVA_RED_GPON_TN' );

--Reverso el detalle de los modelos de las cámaras PTZ y los estados para validar las cuadrillas.
DELETE DB_GENERAL.ADMI_PARAMETRO_DET
WHERE
    DESCRIPCION IN ('MODELOS_CAMARAS_PTZ','ESTADOS_TAREAS_CUADRILLAS')
    AND PARAMETRO_ID = ( SELECT ID_PARAMETRO FROM DB_GENERAL.ADMI_PARAMETRO_CAB WHERE NOMBRE_PARAMETRO = 'PARAMETROS PROYECTO GPON SAFECITY' );

--Reverso el detalle para los estados de los servicios permitidos para la migración a Switch PoE
DELETE DB_GENERAL.ADMI_PARAMETRO_DET
WHERE
    VALOR1 = 'ESTADOS_PERMITIDOS_MIGRACION_SWITCH_POE'
    AND PARAMETRO_ID = ( SELECT ID_PARAMETRO FROM DB_GENERAL.ADMI_PARAMETRO_CAB WHERE NOMBRE_PARAMETRO = 'NUEVA_RED_GPON_TN' );

-- REVERSO DEL TIPO SOLICITUD 'SOLICITUD MIGRACION SWITCH POE'
DELETE DB_COMERCIAL.ADMI_TIPO_SOLICITUD
WHERE
    DESCRIPCION_SOLICITUD = 'SOLICITUD MIGRACION SWITCH POE';

--Reverso el detalle para los datos de la tarea de migración del servicio
DELETE DB_GENERAL.ADMI_PARAMETRO_DET
WHERE
    DESCRIPCION = 'TAREA DE MIGRACION DEL SERVICIO'
    AND VALOR1 = ( SELECT ID_PRODUCTO FROM DB_COMERCIAL.ADMI_PRODUCTO WHERE NOMBRE_TECNICO='SAFECITYDATOS' AND ESTADO = 'Activo' )
    AND PARAMETRO_ID = ( SELECT ID_PARAMETRO FROM DB_GENERAL.ADMI_PARAMETRO_CAB WHERE NOMBRE_PARAMETRO = 'NUEVA_RED_GPON_TN' );
DELETE DB_SOPORTE.ADMI_TAREA
WHERE
    NOMBRE_TAREA = 'MIGRACION SERVICIO SWITCH PoE'
    AND PROCESO_ID = (SELECT ID_PROCESO FROM DB_SOPORTE.ADMI_PROCESO WHERE NOMBRE_PROCESO = 'MIGRACION SERVICIO SAFE CITY SWITCH PoE');
DELETE DB_SOPORTE.ADMI_PROCESO_EMPRESA
WHERE
    PROCESO_ID = (SELECT ID_PROCESO FROM DB_SOPORTE.ADMI_PROCESO WHERE NOMBRE_PROCESO = 'MIGRACION SERVICIO SAFE CITY SWITCH PoE');
DELETE DB_SOPORTE.ADMI_PROCESO
WHERE NOMBRE_PROCESO = 'MIGRACION SERVICIO SAFE CITY SWITCH PoE';

-- ACTUALIZAR LA DESCRIPCION CARACTERÍSTICA DE LA CARACTERÍSTICA 'RELACION_SERVICIOS_GPON_SAFECITY'
UPDATE DB_COMERCIAL.ADMI_CARACTERISTICA SET DESCRIPCION_CARACTERISTICA = 'RELACION_CAMARA_DATOS_SAFECITY',
        USR_ULT_MOD = NULL, FE_ULT_MOD = NULL
    WHERE ESTADO = 'Activo'
    AND DESCRIPCION_CARACTERISTICA = 'RELACION_SERVICIOS_GPON_SAFECITY';

--ACTUALIZAR PARAMETRO CONFIG_PRODUCTO_DATOS_SAFE_CITY - CARACTERÍSTICA 'RELACION_CAMARA_DATOS_SAFECITY'
UPDATE DB_GENERAL.ADMI_PARAMETRO_DET PDE SET PDE.VALOR6 = 'RELACION_CAMARA_DATOS_SAFECITY' WHERE PDE.ID_PARAMETRO_DET = (
    SELECT DET.ID_PARAMETRO_DET FROM DB_GENERAL.ADMI_PARAMETRO_DET DET WHERE DET.PARAMETRO_ID = (
      SELECT CAB.ID_PARAMETRO FROM DB_GENERAL.ADMI_PARAMETRO_CAB CAB WHERE CAB.NOMBRE_PARAMETRO = 'CONFIG_PRODUCTO_DATOS_SAFE_CITY'
    ) AND DET.VALOR2 = 'AGREGAR_SERVICIO_ADICIONAL'
);

-- ACTUALIZAR EL PRODUCTO CARACTERÍSTICA 'Precio Camaras' A SI VISIBLE EN COMERCIAL
UPDATE DB_COMERCIAL.ADMI_PRODUCTO_CARACTERISTICA SET VISIBLE_COMERCIAL = 'SI'
    WHERE ESTADO = 'Activo'
    AND PRODUCTO_ID = (SELECT ID_PRODUCTO FROM DB_COMERCIAL.ADMI_PRODUCTO WHERE NOMBRE_TECNICO = 'DATOS SAFECITY' AND ESTADO = 'Activo')
    AND CARACTERISTICA_ID = (SELECT ID_CARACTERISTICA FROM DB_COMERCIAL.ADMI_CARACTERISTICA WHERE DESCRIPCION_CARACTERISTICA = 'Precio Camaras' AND ESTADO = 'Activo');

-- REVERSO DE LA CABECERA DE PARAMETROS DE 'PRODUCTO_CARACTERISTICA_RELACION_PRODUCTO'
DELETE DB_GENERAL.ADMI_PARAMETRO_DET
WHERE
    PARAMETRO_ID = (
        SELECT
            ID_PARAMETRO
        FROM
            DB_GENERAL.ADMI_PARAMETRO_CAB
        WHERE
            NOMBRE_PARAMETRO = 'PRODUCTO_CARACTERISTICA_RELACION_PRODUCTO'
    );
DELETE DB_GENERAL.ADMI_PARAMETRO_CAB
WHERE
    NOMBRE_PARAMETRO = 'PRODUCTO_CARACTERISTICA_RELACION_PRODUCTO';

--ELIMINAR CARACTERISTICAS DEL PRODUCTO 'MIGRACION_SWITCH_POE'
DELETE FROM DB_COMERCIAL.ADMI_PRODUCTO_CARACTERISTICA
WHERE PRODUCTO_ID = (SELECT ID_PRODUCTO FROM DB_COMERCIAL.ADMI_PRODUCTO WHERE NOMBRE_TECNICO='SAFECITYDATOS' AND ESTADO='Activo' AND EMPRESA_COD=10)
      AND CARACTERISTICA_ID = (SELECT ID_CARACTERISTICA FROM DB_COMERCIAL.ADMI_CARACTERISTICA WHERE DESCRIPCION_CARACTERISTICA = 'MIGRACION_SWITCH_POE' AND ESTADO='Activo');

--ELIMINAR CARACTERISTICA 'MIGRACION_SWITCH_POE'
DELETE FROM DB_COMERCIAL.ADMI_CARACTERISTICA WHERE DESCRIPCION_CARACTERISTICA = 'MIGRACION_SWITCH_POE';

--ELIMINAR CARACTERISTICAS DEL PRODUCTO 'SERVICIO_EN_SWITCH_POE'
DELETE FROM DB_COMERCIAL.ADMI_PRODUCTO_CARACTERISTICA
WHERE PRODUCTO_ID = (SELECT ID_PRODUCTO FROM DB_COMERCIAL.ADMI_PRODUCTO WHERE NOMBRE_TECNICO='SAFECITYDATOS' AND ESTADO='Activo' AND EMPRESA_COD=10)
      AND CARACTERISTICA_ID = (SELECT ID_CARACTERISTICA FROM DB_COMERCIAL.ADMI_CARACTERISTICA WHERE DESCRIPCION_CARACTERISTICA = 'SERVICIO_EN_SWITCH_POE' AND ESTADO='Activo');

--ELIMINAR CARACTERISTICA 'SERVICIO_EN_SWITCH_POE'
DELETE FROM DB_COMERCIAL.ADMI_CARACTERISTICA WHERE DESCRIPCION_CARACTERISTICA = 'SERVICIO_EN_SWITCH_POE';

COMMIT;
/
