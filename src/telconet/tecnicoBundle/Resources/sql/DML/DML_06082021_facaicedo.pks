--=======================================================================
-- Aprovisionamiento de subredes SAFECITY
--=======================================================================

--actualizar producto id de los prefijos para 'SAFE VIDEO ANALYTICS CAM
UPDATE DB_GENERAL.ADMI_PARAMETRO_DET
SET VALOR1 = (SELECT ID_PRODUCTO FROM DB_COMERCIAL.ADMI_PRODUCTO WHERE DESCRIPCION_PRODUCTO = 'SAFE VIDEO ANALYTICS CAM' AND ESTADO = 'Activo'),
    VALOR5 = 'Ocupado'
WHERE ID_PARAMETRO_DET IN (
  SELECT DET.ID_PARAMETRO_DET FROM DB_GENERAL.ADMI_PARAMETRO_DET DET
  INNER JOIN DB_GENERAL.ADMI_PARAMETRO_CAB CAB ON CAB.ID_PARAMETRO = DET.PARAMETRO_ID
  WHERE CAB.NOMBRE_PARAMETRO = 'PARAMETROS MASCARA Y PREFIJOS DE SUBREDES PRODUCTO'
  AND DET.VALOR3 = 'PREFIJOS'
);

--actualizar producto id y la mascara del producto 'SAFE VIDEO ANALYTICS CAM
UPDATE DB_GENERAL.ADMI_PARAMETRO_DET
SET VALOR1 = (SELECT ID_PRODUCTO FROM DB_COMERCIAL.ADMI_PRODUCTO WHERE DESCRIPCION_PRODUCTO = 'SAFE VIDEO ANALYTICS CAM' AND ESTADO = 'Activo'),
VALOR4 = '255.255.255.224'
WHERE ID_PARAMETRO_DET IN (
  SELECT DET.ID_PARAMETRO_DET FROM DB_GENERAL.ADMI_PARAMETRO_DET DET
  INNER JOIN DB_GENERAL.ADMI_PARAMETRO_CAB CAB ON CAB.ID_PARAMETRO = DET.PARAMETRO_ID
  WHERE CAB.NOMBRE_PARAMETRO = 'PARAMETROS MASCARA Y PREFIJOS DE SUBREDES PRODUCTO'
  AND DET.VALOR3 = 'MASCARA'
);

--actualizar producto id y uso de la vlan del producto 'DATOS GPON VIDEO ANALYTICS CAM'
UPDATE DB_GENERAL.ADMI_PARAMETRO_DET
SET VALOR3 = ( SELECT ID_PRODUCTO FROM DB_COMERCIAL.ADMI_PRODUCTO
               WHERE DESCRIPCION_PRODUCTO = 'DATOS GPON VIDEO ANALYTICS CAM' AND ESTADO = 'Activo' ),
    VALOR1 = 'VLAN SAFECITY GPON'
WHERE ID_PARAMETRO_DET = (
  SELECT DET.ID_PARAMETRO_DET FROM DB_GENERAL.ADMI_PARAMETRO_DET DET
  INNER JOIN DB_GENERAL.ADMI_PARAMETRO_CAB CAB ON CAB.ID_PARAMETRO = DET.PARAMETRO_ID
  WHERE CAB.NOMBRE_PARAMETRO = 'NUEVA_RED_GPON_TN'
  AND DET.DESCRIPCION = 'PARAMETRO VLAN PARA SERVICIOS ADICIONALES SAFECITY'
  AND DET.VALOR1 = 'VLAN_SAFECITY_GPON'
);

--actualizar url de configuraci√≥n del producto 'DATOS GPON VIDEO ANALYTICS CAM'
UPDATE DB_GENERAL.ADMI_PARAMETRO_DET
SET VALOR1 = 'rtsp://admin:{{password}}#@{{ipCamara}}:554/Streaming/Channels/PATH'
WHERE ID_PARAMETRO_DET = (
  SELECT DET.ID_PARAMETRO_DET FROM DB_GENERAL.ADMI_PARAMETRO_DET DET
  INNER JOIN DB_GENERAL.ADMI_PARAMETRO_CAB CAB ON CAB.ID_PARAMETRO = DET.PARAMETRO_ID
  WHERE CAB.NOMBRE_PARAMETRO = 'PARAMETROS PROYECTO GPON SAFECITY'
  AND DET.DESCRIPCION = 'FORMATO_URL_CAMARA_SAFECITY'
);

--Ingresamos el detalle para la vlan del producto 'SAFE VIDEO ANALYTICS CAM'
INSERT INTO DB_GENERAL.ADMI_PARAMETRO_DET
(
        ID_PARAMETRO_DET,
        PARAMETRO_ID,
        DESCRIPCION,
        VALOR1,
        VALOR2,
        VALOR3,
        ESTADO,
        USR_CREACION,
        FE_CREACION,
        IP_CREACION
)
VALUES
(
        DB_GENERAL.SEQ_ADMI_PARAMETRO_DET.NEXTVAL,
        (
            SELECT ID_PARAMETRO
            FROM DB_GENERAL.ADMI_PARAMETRO_CAB
            WHERE NOMBRE_PARAMETRO = 'NUEVA_RED_GPON_TN'
            AND ESTADO = 'Activo'
        ),
        'PARAMETRO VLAN PARA SERVICIOS ADICIONALES SAFECITY',
        'VLAN CAM SAFECITY GPON',
        '899',
        ( SELECT ID_PRODUCTO FROM DB_COMERCIAL.ADMI_PRODUCTO
          WHERE DESCRIPCION_PRODUCTO = 'SAFE VIDEO ANALYTICS CAM' AND ESTADO = 'Activo' ),
        'Activo',
        'facaicedo',
        SYSDATE,
        '127.0.0.1'
);

--Ingresamos el detalle para el nombre del uso de la subred del producto 'SAFE VIDEO ANALYTICS CAM'
INSERT INTO DB_GENERAL.ADMI_PARAMETRO_DET
(
        ID_PARAMETRO_DET,
        PARAMETRO_ID,
        DESCRIPCION,
        VALOR1,
        VALOR2,
        ESTADO,
        USR_CREACION,
        FE_CREACION,
        IP_CREACION
)
VALUES
(
        DB_GENERAL.SEQ_ADMI_PARAMETRO_DET.NEXTVAL,
        (
            SELECT ID_PARAMETRO
            FROM DB_GENERAL.ADMI_PARAMETRO_CAB
            WHERE NOMBRE_PARAMETRO = 'NUEVA_RED_GPON_TN'
            AND ESTADO = 'Activo'
        ),
        'PARAMETRO USO SUBRED PARA SERVICIOS ADICIONALES SAFECITY',
        ( SELECT ID_PRODUCTO FROM DB_COMERCIAL.ADMI_PRODUCTO
          WHERE DESCRIPCION_PRODUCTO = 'SAFE VIDEO ANALYTICS CAM' AND ESTADO = 'Activo' ),
        'CAMSAFECITY',
        'Activo',
        'facaicedo',
        SYSDATE,
        '127.0.0.1'
);

--Ingresamos el detalle para la vlan 'SAFE VIDEO ANALYTICS CAM'
INSERT INTO DB_INFRAESTRUCTURA.INFO_DETALLE_ELEMENTO
(
        ID_DETALLE_ELEMENTO,
        ELEMENTO_ID,
        DETALLE_NOMBRE,
        DETALLE_VALOR,
        DETALLE_DESCRIPCION,
        USR_CREACION,
        FE_CREACION,
        IP_CREACION,
        REF_DETALLE_ELEMENTO_ID,
        ESTADO
)
VALUES
(
        DB_INFRAESTRUCTURA.SEQ_INFO_DETALLE_ELEMENTO.NEXTVAL,
        2607157,
        'VLAN CAM SAFECITY GPON',
        '899',
        'VLAN CAM SAFECITY GPON',
        'facaicedo',
        SYSDATE,
        '127.0.0.1',
        NULL,
        'Activo'
);

COMMIT;
/
