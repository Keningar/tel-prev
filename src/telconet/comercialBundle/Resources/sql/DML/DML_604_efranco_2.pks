DECLARE
  --
  CURSOR C_GetProductos
  IS
    --
    SELECT AP.GRUPO,
      AP.SUBGRUPO,
      AP.ID_PRODUCTO,
      IDS.ID_DASHBOARD_SERVICIO,
      (SELECT AC.DESCRIPCION_CARACTERISTICA
      FROM DB_COMERCIAL.ADMI_PRODUCTO_CARACTERISTICA APC
      LEFT JOIN DB_COMERCIAL.ADMI_CARACTERISTICA AC
      ON AC.ID_CARACTERISTICA            = APC.CARACTERISTICA_ID
      WHERE APC.PRODUCTO_ID              = AP.ID_PRODUCTO
      AND AC.DESCRIPCION_CARACTERISTICA IN
        (SELECT APD.DESCRIPCION
        FROM DB_GENERAL.ADMI_PARAMETRO_DET APD
        JOIN DB_GENERAL.ADMI_PARAMETRO_CAB APC
        ON APD.PARAMETRO_ID      = APC.ID_PARAMETRO
        WHERE APD.ESTADO         = 'Activo'
        AND APC.ESTADO           = 'Activo'
        AND APC.NOMBRE_PARAMETRO = 'DASHBOARD_COMERCIAL'
        AND APC.PROCESO          = 'REPORTES'
        AND APC.MODULO           = 'COMERCIAL'
        AND APD.VALOR1           = 'CATEGORIAS_PRODUCTOS'
        AND APD.EMPRESA_COD      =
          (SELECT COD_EMPRESA
          FROM DB_COMERCIAL.INFO_EMPRESA_GRUPO IEG
          WHERE IEG.ESTADO = 'Activo'
          AND IEG.PREFIJO  = 'TN'
          )
        )
      ) AS CATEGORIA
    FROM DB_COMERCIAL.ADMI_PRODUCTO AP
    JOIN DB_COMERCIAL.INFO_DASHBOARD_SERVICIO IDS
    ON IDS.PRODUCTO_ID   = AP.ID_PRODUCTO
    WHERE AP.EMPRESA_COD = '10'
    GROUP BY AP.GRUPO,
      AP.SUBGRUPO,
      AP.ID_PRODUCTO,
      IDS.ID_DASHBOARD_SERVICIO;
    --
  --
  Lr_GetProductos C_GetProductos%ROWTYPE;
  --
BEGIN
  --
  IF C_GetProductos%ISOPEN THEN
    CLOSE C_GetProductos;
  END IF;
  --
  OPEN C_GetProductos;
  LOOP
    --
    FETCH C_GetProductos INTO Lr_GetProductos;
    EXIT WHEN C_GetProductos%NOTFOUND;
    --
    UPDATE DB_COMERCIAL.INFO_DASHBOARD_SERVICIO
    SET GRUPO = Lr_GetProductos.GRUPO, SUBGRUPO = Lr_GetProductos.SUBGRUPO, CATEGORIA = Lr_GetProductos.CATEGORIA
    WHERE ID_DASHBOARD_SERVICIO = Lr_GetProductos.ID_DASHBOARD_SERVICIO;
    --
    COMMIT;
    --
  END LOOP;
  --
END;

