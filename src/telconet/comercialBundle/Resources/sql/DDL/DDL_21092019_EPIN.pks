/*
 * @author Edgar Pin Villavicencio <epin@telconet.ec>
 * @version 1.0 21-09-2019 Se crea la tabla info_adendum y se crea una nueva columna en la info_documento_relacion
 */


CREATE TABLE DB_COMERCIAL.INFO_ADENDUM(
  ID_ADENDUM           NUMBER       NOT NULL,
  FE_CREACION          TIMESTAMP    NOT NULL,
  NUMERO               VARCHAR2(30)         , 
  CONTRATO_ID          NUMBER               ,
  TIPO                 VARCHAR2(2)          ,
  PUNTO_ID             NUMBER       NOT NULL,
  SERVICIO_ID          NUMBER               ,
  IP_CREACION          VARCHAR2(15) NOT NULL,
  USR_CREACION         VARCHAR2(30) NOT NULL,
  ESTADO               VARCHAR2(20)  NOT NULL,
  FE_MODIFICA          TIMESTAMP,
  USR_MODIFICA         VARCHAR2(30),
  FORMA_PAGO_ID        NUMBER, 
	TIPO_CUENTA_ID       NUMBER, 
	BANCO_TIPO_CUENTA_ID NUMBER, 
	NUMERO_CTA_TARJETA   VARCHAR2(200 BYTE), 
	TITULAR_CUENTA       VARCHAR2(200 BYTE), 
	MES_VENCIMIENTO      VARCHAR2(6 BYTE), 
	ANIO_VENCIMIENTO     VARCHAR2(6 BYTE), 
	CODIGO_VERIFICACION  VARCHAR2(20 BYTE),
  PRIMARY KEY(ID_ADENDUM),
  CONSTRAINT FK_ADENDUM_PUNTO    FOREIGN KEY (PUNTO_ID)    REFERENCES DB_COMERCIAL.INFO_PUNTO    (ID_PUNTO),
  CONSTRAINT FK_ADENDUM_SERVICIO FOREIGN KEY (SERVICIO_ID) REFERENCES DB_COMERCIAL.INFO_SERVICIO (ID_SERVICIO)
);

COMMENT ON COLUMN DB_COMERCIAL.INFO_ADENDUM.ID_ADENDUM   IS 'ID DE LA TABLA ADENDUM';
COMMENT ON COLUMN DB_COMERCIAL.INFO_ADENDUM.FE_CREACION  IS 'FECHA DE CREACION DEL ADENDUM';
COMMENT ON COLUMN DB_COMERCIAL.INFO_ADENDUM.NUMERO       IS 'NUMERO DEL ADENDUM';
COMMENT ON COLUMN DB_COMERCIAL.INFO_ADENDUM.CONTRATO_ID  IS 'CONTRATO AL QUE ESTA RELACIONADO EL ADENDUM';
COMMENT ON COLUMN DB_COMERCIAL.INFO_ADENDUM.TIPO         IS 'P) ADENDUM DE PUNTO, S) ADENDUM DE SERVICIO';
COMMENT ON COLUMN DB_COMERCIAL.INFO_ADENDUM.PUNTO_ID     IS 'ID DEL PUNTO AL QUE ESTA RELACIONADO EL ADENDUM';
COMMENT ON COLUMN DB_COMERCIAL.INFO_ADENDUM.SERVICIO_ID  IS 'ID DEL SERVICIO AL QUE ESTA RELACIONADO EL ADENDUM';
COMMENT ON COLUMN DB_COMERCIAL.INFO_ADENDUM.IP_CREACION  IS 'IP DESDE LA CUAL SE ENVIO A CREAR EL ADENDUM';
COMMENT ON COLUMN DB_COMERCIAL.INFO_ADENDUM.USR_CREACION IS 'LOGIN DEL USUARIO QUE ENVIO A CREAR EL ADENDUM';
COMMENT ON COLUMN DB_COMERCIAL.INFO_ADENDUM.ESTADO       IS 'ID DEL PUNTO AL QUE ESTA RELACIONADO EL ADENDUM';
COMMENT ON COLUMN DB_COMERCIAL.INFO_ADENDUM.FE_MODIFICA  IS 'FECHA DE MODIFICACION DEL REGISTRO';
COMMENT ON COLUMN DB_COMERCIAL.INFO_ADENDUM.USR_MODIFICA IS 'LOGIN DEL USUARIO QUE MODIFICA EL REGISTRO';

CREATE SEQUENCE  "DB_COMERCIAL"."SEQ_INFO_ADENDUM"  MINVALUE 0 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 NOCACHE  NOORDER  NOCYCLE ;

CREATE INDEX IDX_SERVICIO
ON DB_COMERCIAL.INFO_ADENDUM (SERVICIO_ID);

CREATE INDEX IDX_CONTRATO
ON DB_COMERCIAL.INFO_ADENDUM (CONTRATO_ID);

CREATE INDEX IDX_FE_CREACION
ON DB_COMERCIAL.INFO_ADENDUM (FE_CREACION);

ALTER TABLE DB_COMERCIAL.INFO_SERVICIO ADD ORIGEN VARCHAR2(20);

COMMENT ON COLUMN DB_COMERCIAL.INFO_SERVICIO.ORIGEN IS 'DEFINE EL ORIGEN DE DONDE SE CREO EL SERVICIO: WEB, MOVIL';


ALTER TABLE DB_COMUNICACION.INFO_DOCUMENTO_RELACION ADD NUMERO_ADENDUM VARCHAR2(30);

COMMENT ON COLUMN DB_COMUNICACION.INFO_DOCUMENTO_RELACION.NUMERO_ADENDUM IS 'NUMERO DEL ADENDUM DE CONTRATO DIGITAL AL QUE PERTENECEN LOS DOCUMENTOS';

