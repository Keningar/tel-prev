{% extends "::layout.html.twig" %}
{% block stylesheets %}
{{ parent() }}
<link href="{{ asset('public/js/jquery-tooltip/jquery.tooltip.css') }}" type="text/css" rel="stylesheet" />
<style type="text/css">

    #tooltip.pretty {
            border: none;
            width: 250px;
            padding:20px;
            height: 135px;
            opacity: 2;
            background: url('');
    }

    #tooltip.pretty div { 
        width: 220px; 
        text-align: left; 
        background-color: #F9F9F9;
        border: 1px solid #DDDDDD;
        border-radius: 4px 4px 4px 4px;
        box-shadow: 0 0 3px #D7D7D7;
        margin: 11px 11px 11px;
        padding: 7px 7px 7px;
        min-height: 7em;
        font-family: Verdana, Arial, Helvetica, sans-serif;
        font-size:12px;		
    }

    #tooltiptable{
        font-family: Verdana, Arial, Helvetica, sans-serif;
        font-size:9px;
        font-weight:normal;
        text-align: left;
        padding: 8px;
        margin: 5px;
    }
</style>        
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script>
       
        var urlGetInfoPersonaFormaContacto = "{{ path('contacto_getInfoPersonaFormaContacto') }}";  
        var url_verificar_recomendaciones        = "{{ path('cliente_ajaxVerificarRecomendaciones') }}";
        
        var urlGetAdmiFormaContacto        = "{{ path('admiformacontacto_getAdmiFormaContacto') }}";
        var urlRepresentanteLegalVerificar  = "{{ path('cliente_ajaxRepresentanteLegalVerificar') }}";
        var urlRepresentanteLegalConsultar  = "{{ path('cliente_ajaxRepresentanteLegalConsultar') }}";
        var urlRepresentanteLegalActualizar = "{{ path('cliente_ajaxRepresentanteLegalActualizar') }}";
        var urlValidarFormaContacto         = "{{ path('contacto_ajaxValidarFormaContacto') }}";
        
    </script>
    <script type="text/javascript" src="{{ asset('./bundles/comercial/js/cliente/representanteLegal.js?3') }}"></script>
{% endblock %}
 
{% block flujo %}
<div style='background-color: #F9F9F9;
            border: 1px solid #DDDDDD;
            border-radius: 4px 4px 4px 4px;
            box-shadow: 0 0 3px #D7D7D7;
            margin: 11px 11px 11px;
            padding: 3px 6px 3px;
            min-height: 7em;
            width: 97%;'>
    <table border='0' cellpadding='0' cellspacing='0' width='290px' align='left'>
        <tr>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td>	
                <span id='flujo-ptoscliente' title="">
                    <img id="img_flujo_ptoscliente" src="{{ asset('public/images/ptos_cliente_gris.png') }}"/>
                </span>
            </td>
            <td>
                <img  src="{{ asset('public/images/circle_blue.png') }}"/>
            </td>
            <td>
                <span id='flujo-contactos' title="">
                    <img id='img_flujo_contactos' src="{{ asset('public/images/address_book_gris.png') }}"/>
                </span>
            </td>
            <td>
                <img src="{{ asset('public/images/circle_blue.png') }}"/>
            </td>
            <td>
                <span id='flujo-contrato' title="">
                    <img id='img_flujo_contrato' src="{{ asset('public/images/com-contrato_gris.png') }}"/>
                </span>
            </td>
        </tr>
    </table>
</div>
{% endblock flujo %} 

{% block contenido_izq %}
    {% set strIva    = 'IVA' %}
    {% if app.session.get('strNombrePais') == 'PANAMA' %}
        {% set strIva    = 'ITBMS' %}
    {% endif %}
    <div id="titulo_content">
        <table>
            <tr>
                <td width="60px">
                    <img src="{{ asset('public/images/'~ item.urlImagen | default('tools1.png') ~ '') }}" class="imagen-titulo-content">
                </td>
                <td width="70px">
                    <h1>Ver Cliente</h1>
                </td>
                <td id="divToolBarVip" width="180px">
                    <div id="toolBarVip"/>
                </td>
            </tr>
        </table>
    </div>
    <div class="body_content">
        {% for flashMessage in app.session.flashbag.get('warning') %}
            <div class="warningmessage">
                {{ flashMessage }}
            </div>
        {% endfor %}
        {%if (nombreClienteCambioRazonSocial)%}
            <div class="infomessage">
                Este cliente fue creado por cambio de razon social de: 
                <a  href="{{ path('cliente_show', { 'id': idPersonaCR,'idper':idPerCR }) }}">
                        {{nombreClienteCambioRazonSocial}}
                </a>                                            
            </div>                                
        {%endif%}      
        <table class="record_properties" width='100%' border='0'>
            {%if(entity.tipoEmpresa is not null)%}
                <tbody>
                    <tr height="18px">
                        <td width="145px"><b>Tipo Identificación:</b></td>
                        <td width="500px">
                                    {%if(entity.tipoIdentificacion == 'CED')%}Cedula
                                    {%elseif(entity.tipoIdentificacion == 'RUC')%}Ruc
                                    {%elseif(entity.tipoIdentificacion == 'PAS')%}Pasaporte
                                    {%endif%}
                        </td>
                        <td width="100px"><b>Tipo Empresa:</b></td>
                        <td>{{ entity.tipoEmpresa }}</td>
                    </tr>
                    <tr height="18px">
                        <td><b>Dirección Tributaria:</b></td>
                        <td>{{ entity.direccionTributaria }}</td>
                        <td><b>Identificación:</b></td>
                        <td>{{ entity.identificacionCliente }}</td>  
                    </tr>
                    <tr height="18px">
                        <td><b>Nombre Cliente:<b></td>
                        {%if (entity.razonSocial) %}
                            <td>{{ entity.razonSocial }}</td>            
                        {%else%}
                            <td>{{ entity.nombres }} {{ entity.apellidos }}</td>
                        {%endif%}
                        <td><b>Nacionalidad:<b></td>
                        <td>
                            {%if(entity.nacionalidad == 'NAC')%}Nacional
                            {%elseif(entity.nacionalidad == 'EXT')%}Extranjero
                            {%endif%}
                        </td>
                    </tr>
                    <tr height="18px">          
                        <td><b>Representante Legal:<b></td>
                        <td>{{ entity.representanteLegal }}</td>
                        <td><b>Referido Por:</b></td>
                    {% if referido is not null  %}    
                        {% if referido.razonSocial is not null  %}
                            <td><a href="{{ path('cliente_show',{'id':referido.id,'idper':idper}) }}">{{ referido.razonSocial }}</a></td>
                        {% else %}
                            <td><a href="{{ path('cliente_show',{'id':referido.id,'idper':idper}) }}">{{ referido.nombres }} {{ referido.apellidos }}</a></td>
                        {% endif %}
                    {% else %}
                        <td>No fue referido</td>    
                    {% endif %}
                    </tr>         
                    <tr height="18px">
                        <td><b>Tipo Tributario:</b></td> 
                        <td>{%if(entity.tipoTributario == 'NAT')%} Natural
                            {%elseif(entity.tipoTributario == 'JUR')%} Juridica
                            {%endif%}
                        </td>
                        <td><b>Estado:</b></td>
                        <td>{{ estado }}</td>
                    </tr>
                     
                    <tr height="18px">
                        <td><b>Fue Prospecto:</b></td>
                        <td>
                            {%if(entity.origenProspecto == 'S')%}Si
                            {%elseif(entity.origenProspecto == 'N')%}No
                            {%endif%}
                        </td> 
                        
                        <td><b>Debitos:</b></td>
                        <td>           
                            <div class="infomessage" style="width:200px">
                                <a href='#' onClick="verDebitosPorCliente({{idper}})">Ver historial de debitos</a>    
                            </div>                            
                        </td>
                    </tr>
                    <tr height="18px">
                        {%if prefijoEmpresa=='TN'%}
                            <td><b>Es Cliente VIP:</b></td>
                            <td>
                                <table>
                                    <tr>
                                        <td width="25px">
                                            {{esVip}}                          
                                        </td>
                                        
                                        {%if esVip == 'Sí' or esVipTecnico == 'Sí'%}
                                        <td width="50px">
                                            <div id="toolIngVip"></div>
                                        </td>
                                        {%else%}
                                        <td>
                                            <div id="toolIngVip"></div>
                                        </td>
                                        {%endif%}
                                        
                                    </tr>
                                </table>
                            </td>
                            <td><b>Es VIP T&eacute;cnico:</b></td>
                            <td>
                                <table>
                                    <tr>
                                        <td width="25px" id="labelVipTecnico">
                                            {{esVipTecnico}}
                                        </td>
                                        <td width="50px">
                                            <div id="toolVipTecnico"></div>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        {%else%}
                        <td></td>
                        <td></td>
                        {%endif%}
                    </tr>
                    <tr height="18px">
                        <td><b>Estado del Contrato:</b></td>
                        
                        {% if(contrato is not null) %}
                            <td class="">{{contrato.estado}}</td>                            
                        {%else%}
                            <td class="errormessage">Cliente No Dispone de Contrato.</td>
                        {%endif%}
                        
                        <td><b>Fecha Fin Contrato:</b></td>
                        
                        {% if(contrato is not null) %}                            
                            <td id="tdFeFinContrato" name="tdFeFinContrato">{{strFeFinContrato}}</td>                            
                        {%else%}
                            <td class="errormessage">Cliente No Dispone de Fecha Fin de Contrato.</td>
                        {%endif%}
                    </tr>                    
                    <tr height="18px">
                        <td><b>Contribuyente Especial:</b></td>
                        
                        {% if(entity.contribuyenteEspecial == 'S') %}
                        <td>Sí</td>
                        {%else%}
                        <td>No</td>
                        {%endif%}
                        
                        <td><b>Es Prepago:</b></td>
                        
                        {% if(esPrepago == 'S') %}
                        <td id="tdEsPrepago" name="{{esPrepago}}">Sí</td>
                        {%elseif(esPrepago == 'N')%}
                        <td id="tdEsPrepago" name="{{esPrepago}}">No</td>
                        {%else%}
                        <td id="tdEsPrepago" name="{{esPrepago}}">Postpago Manual</td>                        
                        {%endif%}
                        
                    </tr>
                    
                    <tr height="18px">                                              
                        <td><b>Contribución Solidaria:</b></td>
                        
                        {% if(strContrSolidaria == 'S') %}
                        <td id="tdContribucionSolidaria" name="{{strContrSolidaria}}">Sí</td>
                        {%else%}
                        <td id="tdContribucionSolidaria" name="{{strContrSolidaria}}">No</td>
                        {%endif%}
                        
                        {% if (prefijoEmpresa =='TN') %}
                         {%if(oficinaFacturacion is not null)%}                          
                          <td><b>Oficina de Facturación:</b></td>
                          <td>{{  oficinaFacturacion.nombreOficina }}</td>                          
                         {%endif%} 
                       {%endif%}  
                    </tr>
                    <tr height="18px">
                        <td><b>Paga {{ strIva }}:</b></td>
                        
                        {% if(entity.pagaIva == 'S') %}
                            <td id="tdPagaIva" name="{{entity.pagaIva}}">Sí</td>
                        {%else%}
                            <td id="tdPagaIva" name="{{entity.pagaIva}}">No</td>
                        {%endif%}
                        
                        {% if (prefijoEmpresa =='MD' or prefijoEmpresa == 'EN' ) %}
                         <td><b>Ciclo de Facturacion:</b></td>	
                         <td>{{strNombreCiclo}}</td>		                
                        {%endif%}
                
                    </tr>    
                    <tr>
                        <td>
                        &nbsp;
                        </td>
                    </tr> 
                    <tr bgcolor='#ffffff'>
                        {%if prefijoEmpresa=='TN'%}
                        <td bgcolor='#ffffff' colspan="4"><div id='lista_ingenieros_vip'></div></td>
                        {%endif%}
                    </tr>  
                    </tr>                            
                    <tr>
                        <td>
                        &nbsp;
                        </td>
                    </tr>                            
                    <tr>
                        <td  colspan='4'>
                            <table>
                                {%for item in formasContacto%}
                                <tr>
                                    <td  width='30'>
                                        <b>
                                        {% if (item.formaContactoId.descripcionFormaContacto=='Telefono Fijo') %}
                                                <img src='/public/images/images_crud/contact.png'>
                                        {%elseif (item.formaContactoId.descripcionFormaContacto=='Telefono Movil Claro') or
                                        (item.formaContactoId.descripcionFormaContacto=='Telefono Movil Claro') or
                                        (item.formaContactoId.descripcionFormaContacto=='Telefono Movil Movistar') or
                                        (item.formaContactoId.descripcionFormaContacto=='Telefono Movil CNT') or 
                                        (item.formaContactoId.descripcionFormaContacto=='Telefono Movil Cable and Wireless') or
                                        (item.formaContactoId.descripcionFormaContacto=='Telefono Movil Digicel') %}
                                                <img src='/public/images/images_crud/phone.png'>				
                                        {%elseif (item.formaContactoId.descripcionFormaContacto=='Correo Electronico')%}
                                                <img src='/public/images/images_crud/mail.png'>							
                                        {%elseif (item.formaContactoId.descripcionFormaContacto=='Facebook')%}
                                                <img src='/public/images/images_crud/facebook.png'>							
                                        {%elseif (item.formaContactoId.descripcionFormaContacto=='Twitter')%}
                                                <img  width='16' height='16' src='/public/images/images_crud/twitter.png'>														
                                        {%elseif (item.formaContactoId.descripcionFormaContacto=='Telefono Movil')%}
                                                <img src='/public/images/images_crud/phone.png'>							
                                        {%endif%}
                                        </b>
                                    </td>
                                <td>
                                    {{item.valor}}
                                </td>		
                                </tr>					
                                {%endfor%}
                            </table>
                        </td> 		
                    </tr>			
                </tbody>
            {%else%}
                
                <tbody>
                    <tr height="18px">
                        <td width="145px"><b>Tipo Identificación:</b></td>
                        <td width="500px">
                            {%if(entity.tipoIdentificacion == 'CED')%}Cedula
                            {%elseif(entity.tipoIdentificacion == 'RUC')%}Ruc
                            {%elseif(entity.tipoIdentificacion == 'PAS')%}Pasaporte
                            {%endif%}
                        </td>
                        <td width="125px"><b>Origen de Ingresos:</b></td>
                        <td>
                            {%if(entity.origenIngresos == 'B')%}Empleado Público
                            {%elseif(entity.origenIngresos == 'V')%}Empleado Privado
                            {%elseif(entity.origenIngresos == 'I')%}Independiente
                            {%elseif(entity.origenIngresos == 'A')%}Ama de casa o estudiante
                            {%elseif(entity.origenIngresos == 'R')%}Rentista
                            {%elseif(entity.origenIngresos == 'J')%}Jubilado
                            {%elseif(entity.origenIngresos == 'M')%}Remesas del exterior
                            {%endif%}
                        </td>
                    </tr>
                    <tr height="18px">
                        <td><b>Identificación:</b></td>
                        <td>{{ entity.identificacionCliente }}</td>   
                        <td><b>Estado Civil:</b></td>
                        <td>
                            {%if(entity.estadoCivil == 'C')%}Casado(a)
                            {%elseif(entity.estadoCivil == 'S')%}Soltero(a)
                            {%elseif(entity.estadoCivil == 'D')%}Divorciado(a)
                            {%elseif(entity.estadoCivil == 'V')%}Viudo(a)
                            {%elseif(entity.estadoCivil == 'U')%}Uni&oacute;n Libre
                            {%else%}{{entity.estadoCivil}}
                            {%endif%}
                        </td>
                    </tr>
                    <tr height="18px">
                        <td><b>Nombre Cliente:<b></td>
                        {%if (entity.razonSocial) %}
                            <td>{{ entity.razonSocial }}</td>            
                        {%else%}
                            <td>{{ entity.nombres }} {{ entity.apellidos }}</td>
                        {%endif%}
                        <td><b>Nacionalidad:<b></td>
                        <td>
                            {%if(entity.nacionalidad == 'NAC')%}Nacional
                            {%elseif(entity.nacionalidad == 'EXT')%}Extranjera
                            {%endif%}
                        </td>
                    </tr>
                    <tr height="18px">      
                        <td><b>Dirección Tributaria:</b></td>
                        <td>{{ entity.direccionTributaria }}</td>
                        <td><b>Referido Por:</b></td>
                            {% if referido is not null  %}    
                                {% if referido.razonSocial is not null  %}
                                    <td><a href="{{ path('cliente_show',{'id':referido.id,'idper':idper}) }}">{{ referido.razonSocial }}</a></td>
                                {% else %}
                                    <td><a href="{{ path('cliente_show',{'id':referido.id,'idper':idper}) }}">{{ referido.nombres }} {{ referido.apellidos }}</a></td>
                                {% endif %}
                            {% else %}
                                <td>No fue referido</td>    
                            {% endif %}
                    </tr>
                    <tr height="18px">
                        <td><b>Representante Legal:<b></td>
                        <td>{{ entity.representanteLegal }}</td>
                        <td><b>Fecha Nacimiento:</b></td>
                        {% if entity.fechaNacimiento is not null  %}
                        <td>{{ entity.fechaNacimiento|date('d-m-Y') }}</td>
                        {% else %}
                        <td></td>
                        {% endif %}
                    </tr>
                    <tr height="18px">
                        <td><b>Tipo Tributario:</b></td>
                        <td>
                            {%if(entity.tipoTributario == 'NAT')%} Natural
                            {%elseif(entity.tipoTributario == 'JUR')%} Juridica
                            {%endif%}
                        </td>
                        <td><b>Estado:</b></td>
                        <td>{{ estado }}</td>
                    </tr>                    
                    <tr height="18px">
                        <td><b>Genero:</b></td>
                        <td>
                            {%if(entity.genero == 'M')%}Masculino
                            {%elseif(entity.genero == 'F')%}Femenino
                            {%endif%}
                        </td> 
                        <td><b>Fue Prospecto:</b></td>
                        <td>
                            {%if(entity.origenProspecto == 'S')%}Si
                            {%elseif(entity.origenProspecto == 'N')%}No
                            {%endif%}
                        </td>           
                    </tr>
                    <tr height="18px">
                        
                        {% if(contrato is not null) %}
                        <td><b>Estado del Contrato:</b></td>
                        <td>{{contrato.estado}}</td>
                        {%else%}
                        <td></td>
                        <td></td>
                        {%endif%}
                        
                        <td><b>Debitos:</b></td>
                        <td>           
                            <div class="infomessage" style="width:200px">
                                <a href='#' onClick="verDebitosPorCliente({{idper}})">Ver historial de debitos</a>    
                            </div>                            
                        </td>
                    </tr>
                    <tr height="18px">
                        {%if prefijoEmpresa=='TN'%}
                            <td><b>Es Cliente VIP:</b></td>
                            <td>
                                <table>
                                    <tr>
                                        <td width="25px">
                                            {{esVip}}                          
                                        </td>
                                        
                                        {%if esVip == 'Sí' or esVipTecnico == 'Sí'%}
                                        <td width="50px">
                                            <div id="toolIngVip"></div>
                                        </td>
                                        {%else%}
                                        <td><div id="toolIngVip"></div></td>
                                        {%endif%}
                                        
                                    </tr>
                                </table>
                            </td>
                            <td><b>Es VIP T&eacute;cnico:</b></td>
                            <td>
                                <table>
                                    <tr>
                                        <td width="25px" id="labelVipTecnico">
                                            {{esVipTecnico}}
                                        </td>
                                        <td width="50px">
                                            <div id="toolVipTecnico"></div>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        {%else%}
                            <td></td>
                            <td></td>
                        {%endif%}
                            
                    </tr>
                    <tr height="18px">
                        <td><b>Carnet Conadis:</b></td>
                        
                        {% if(entity.numeroConadis is not null) %}
                        <td>{{entity.numeroConadis}}</td>
                        {%else%}
                        <td>No Aplica</td>
                        {%endif%}
                            
                        <td><b>Paga {{ strIva }}:</b></td>
                        
                        {% if(entity.pagaIva == 'S') %}
                            <td id="tdPagaIva" name="{{entity.pagaIva}}">Sí</td>
                        {%else%}
                            <td id="tdPagaIva" name="{{entity.pagaIva}}">No</td>
                        {%endif%}

                    </tr>
                    
                    <tr height="18px">
                        <td><b>Contribuyente Especial:</b></td>
                        
                        {% if(entity.contribuyenteEspecial == 'S') %}
                        <td>Sí</td>
                        {%else%}
                        <td>No</td>
                        {%endif%}
                        
                        <td><b>Es Prepago:</b></td>
                        
                        {% if(esPrepago == 'S') %}
                        <td id="tdEsPrepago" name="{{esPrepago}}">Sí</td>
                        {%elseif(esPrepago == 'N')%}
                        <td id="tdEsPrepago" name="{{esPrepago}}">No</td>
                        {%else%}
                        <td id="tdEsPrepago" name="{{esPrepago}}">Postpago Manual</td>  
                        {%endif%}
                        
                    </tr>                    
                    
                    <tr height="18px">                                              
                        <td><b>Contribución Solidaria:</b></td>
                        
                        {% if(strContrSolidaria == 'S') %}
                        <td id="tdContribucionSolidaria" name="{{strContrSolidaria}}">Sí</td>
                        {%else%}
                        <td id="tdContribucionSolidaria" name="{{strContrSolidaria}}">No</td>
                        {%endif%}
                        
                       {% if (prefijoEmpresa =='TN') %}
                         {%if(oficinaFacturacion is not null)%}                          
                          <td><b>Oficina de Facturación:</b></td>
                          <td>{{  oficinaFacturacion.nombreOficina }}</td>                          
                         {%endif%}                        
                       
                       {% elseif (prefijoEmpresa =='MD' or prefijoEmpresa == 'EN') %}
                         <td><b>Ciclo de Facturacion:</b></td>	
                         <td>{{strNombreCiclo}}</td>		                
                        {%endif%}
                         
                    </tr> 
                    {% if (prefijoEmpresa =='TN') %}
                        <tr height="18px">
                            {%if(strEsDistribuidor is not null)%}
                                <td><b>Es Distribuidor:</b></td>
                                <td>{{strEsDistribuidor }}</td>
                            {%endif%}
                        </tr>
                    {%endif%}
                    <tr>
                        <td>
                        &nbsp;
                        </td>
                    </tr> 
                    <tr bgcolor='#ffffff'>
                        {%if prefijoEmpresa=='TN'%}
                        <td bgcolor='#ffffff' colspan="4"><div id='lista_ingenieros_vip'></div></td>
                        {%endif%}
                    </tr>
                    <tr>
                        <td>
                        &nbsp;
                        </td>
                    </tr>                     
                    <tr>
                        <td  colspan='4'>
                            <table>
                                {%for item in formasContacto%}
                                    <tr>					
                                        <td  width='30'><b>
                                            {% if (item.formaContactoId.descripcionFormaContacto=='Telefono Fijo') %}
                                                    <img src='/public/images/images_crud/contact.png'>
                                            {%elseif (item.formaContactoId.descripcionFormaContacto=='Telefono Movil Claro') or
                                            (item.formaContactoId.descripcionFormaContacto=='Telefono Movil Claro') or
                                            (item.formaContactoId.descripcionFormaContacto=='Telefono Movil Movistar') or
                                            (item.formaContactoId.descripcionFormaContacto=='Telefono Movil CNT') or 
                                        (item.formaContactoId.descripcionFormaContacto=='Telefono Movil Cable and Wireless') or
                                        (item.formaContactoId.descripcionFormaContacto=='Telefono Movil Digicel') %}
                                                    <img src='/public/images/images_crud/phone.png'>				
                                            {%elseif (item.formaContactoId.descripcionFormaContacto=='Correo Electronico')%}
                                                    <img src='/public/images/images_crud/mail.png'>							
                                            {%elseif (item.formaContactoId.descripcionFormaContacto=='Facebook')%}
                                                    <img src='/public/images/images_crud/facebook.png'>							
                                            {%elseif (item.formaContactoId.descripcionFormaContacto=='Twitter')%}
                                                    <img  width='16' height='16' src='/public/images/images_crud/twitter.png'>														
                                            {%elseif (item.formaContactoId.descripcionFormaContacto=='Telefono Movil')%}
                                                    <img src='/public/images/images_crud/phone.png'>							
                                            {%endif%}
                                            </b>
                                        </td>
                                        <td>
                                            {{item.valor}}
                                        </td>		
                                    </tr>					
                                {%endfor%}
                            </table>
                        </td> 		
                    </tr>						
                </tbody>
            {%endif%}             
        </table>
    </div>
    <input id='feFinContrato' name='feFinContrato' type='hidden' value="{{strFeFinContrato}}">
    <div  class="body_content">
        <table width="100%" cellpadding="1" cellspacing='0'  border='0'>             
            <tr bgcolor='#ffffff'>
                <td bgcolor='#ffffff'><div id='filtro_ptos'></div></td>
            </tr>	
            <tr bgcolor='#ffffff'>
                <td bgcolor='#ffffff'><div id='lista_ptos'></div></td>
            </tr>
        </table>   

        <script>
            var verHistorial                    = "{{verHistorial}}";            
            var prefijoEmpresa                  = "{{prefijoEmpresa}}";
            var url_cliente_delete_ajax         = "#";
            var url_anula_punto_ajax            = "{{ path('infopunto_anula_punto') }}";
            var url_puntos_lista_estados        = "{{ path('search_ajaxGetEstadosPunto') }}";
            var url_ver_historial_puntos        = "{{ path('infopunto_ver_historial_punto') }}";
            var url_historial_debitos           = "{{ path('admiformatodebito_grid_debitos_por_punto') }}";
            var url_historial_debitos_cliente   = "{{ path('admiformatodebito_grid_debitos_por_cliente') }}";                
            var url_gridPtos                    = "{{ path('infopunto_getpuntospersonaemprol', {'idper':idper, 'rol':'Cliente'}) }}";
            var urlRutaGeorreferencial          = "{{ path('cliente_getRutaGeorreferencial') }}";
            var urlDefinirClienteVIPNormal      = "{{ path('cliente_getAjaxDefinirClienteVIPNormal') }}";
            var urlGridHistorialVIP             = "{{ path('cliente_gridAjaxHistorialVIP', {'idPer':idper}) }}";
            var urlGridHistorialCliente         = "{{ path('cliente_gridAjaxHistorialCliente', {'idPer':idper}) }}";
            var urlActualizarDatosFacturacion   = "{{ path('cliente_ajaxActualizarDatosFacturacion') }}";
            var esVip                           = "{{ esVip }}";
            var idPer                           = "{{ idper }}";
            var esVipTecnico                    = "{{ esVipTecnico }}";
            var strEsDistribuidor               = "{{ strEsDistribuidor }}";
            
            var url_grid_ingenieros_vip         = "{{path('cliente_gridIngenierosVIPCliente',  {'idPer':idper})}}";
            var url_cambiar_marca_vip_tecnico   = "{{path('cliente_cambiarMarcaVIPTecnico',  {'intIdPer':idper})}}";
            var urlActualizarFeFinContrato      = "{{path('cliente_ajaxActualizarFeFinContrato') }}";
            var strEstadoContrato               = "{{ strEstadoContrato }}";
        </script>
        <script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=false"></script>
        <script type="text/javascript" src="{{ asset('./bundles/comercial/js/cliente/gridPtosCliente.js?3') }}"></script>
        <script type="text/javascript" src="{{ asset('./bundles/comercial/js/cliente/gridHistorialDebitosPorCliente.js') }}"></script>
        <script type="text/javascript" src="{{ asset('./bundles/comercial/js/infopunto/verHistorial.js') }}"></script>
        <script type="text/javascript" src="{{ asset('./bundles/comercial/js/cliente/show.js?9') }}"></script>
    </div>

    <div class="buttons">
        <p>
            <span class="height20px">
                <a class="button-crud" href="{{ path('cliente') }}">Regresar</a>
            </span>
        </p>
    </div>        

    <div class="body_content">
        <table class="formulario">
            <tbody>
                <tr>
                    <td width="10%" rowspan="4"><img src="{{ asset('public/images/images_crud/agregar_64.png')}}" hspace="3" vspace="3" alt="" border="0" align="absmiddle" /></td>
                    <th width="11%">Creador:</th>
                    <td width="34%" >{% if(creacion is not null)%}  {{creacion.usrCreacion}}  {% endif %}</td>

                    {% if(ultMod is not null) %}
                        <td width="10%" rowspan="3"><img src="{{ asset('public/images/images_crud/edit_64.png')}}" hspace="3" vspace="3" alt="" border="0" align="absmiddle" /></td>
                        <th width="11%" >Ult. Mod.:</th>
                        <td width="34%">{{ ultMod.usrCreacion }}</td>
                    {% endif %}

                    {% if(eliminado is not null)%}
                        <td width="10%" rowspan="3"><img src="{{ asset('public/images/images_crud/eliminar_64.png')}}" hspace="3" vspace="3" alt="" border="0" align="absmiddle" /></td>
                        <th width="6%">Eliminado:</th>
                        <td width="34%">{{ eliminado.usrCreacion }}</td>
                    {% endif %}
                </tr>
	        <tr>
                    <th>Fecha:</th>
                    <td >{% if(creacion is not null) %}{{ creacion.feCreacion | date("d M Y") }} {% endif %}</td>

                    {% if(ultMod is not null) %}
                    <th>Fecha:</th>
                    <td >{{ ultMod.feCreacion  | date("d M Y")}}</td>
                    {% endif %}

                    {% if(eliminado is not null) %}
                    <th>Fecha:</th>
                    <td>{{ eliminado.feCreacion | date("d M Y") }}</td>
                    {% endif %}
                </tr>
                <tr>
                    <th>Hora:</th>
                    <td>{% if(creacion is not null) %} {{ creacion.feCreacion | date("H:i:s") }} {%endif%}</td>

                    {% if(ultMod is not null) %}
                    <th>Hora:</th>
                    <td>{{ ultMod.feCreacion | date("H:i:s") }}</td>
                    {% endif %}

                    {% if(eliminado is not null) %}
                    <th>Hora:</th>
                    <td>{{ eliminado.feCreacion | date("H:i:s") }}</td>
                    {% endif %}
                </tr>
                <tr>
                    <th>Ip:</th>
                    <td>{% if(creacion is not null) %} {{ creacion.ipCreacion}} {%endif%}</td>
                </tr>   
            </tbody>
        </table>
    </div>
{% endblock contenido_izq %}

{% block contenido_der %}
    <br />
    <ul class="form_actions">
        {% if (estado != "Activo" and estado != "Cancel" and estado != "Cancelado") %}
            <li>
                <a class="button-editar" href="{{ path('cliente_edit', { 'id': entity.id }) }}">
                        Editar
                </a>
            </li>
        {% endif %}
        {%if (is_granted("ROLE_311-3077") and (estado == "Activo" or estado == "Pendiente" or estado == "Pend-convertir"))   %}
            {% if (floatSaldoPendiente > 100) %}
                <li>
                    <a class="button-editar" href="#" onclick="getValidacionRazonSocial({{floatSaldoPendiente}});" >
                            Cambio de Razon Social
                    </a>
                </li>
                <li>
                    <a class="button-editar" href="#" onclick="getValidacionRazonSocial({{floatSaldoPendiente}});" >
                            Cambio de Razon Social por Login
                    </a>
                </li>
            {%else%}
                <li>
                    <a class="button-editar" href="{{ path('cliente_cambio_razon_social', { 'id': entity.id,'idper':idper }) }}">
                            Cambio de Razon Social
                    </a>
                </li>
                <li>
                    <a class="button-editar" href="{{ path('cliente_cambioRazonSocialPorPunto', { 'id': entity.id,'idper':idper }) }}">
                            Cambio de Razon Social por Login
                    </a>
                </li>
            {% endif %}
       {%endif%}
    </ul>		
    <div class="titulo-acciones-relacionadas">
            Acciones Relacionadas
    </div>
    <ul class="listado_acciones_relacionadas">
        {%if (prefijoEmpresa == 'MD' or prefijoEmpresa == 'EN') %}
           <li>
                <a class="listado_ac_tablas"  href="#"  onClick="verRecomendacionesEquifax('{{entity.tipoIdentificacion}}', '{{entity.identificacionCliente }}', '{{ entity.tipoTributario}}')">Recomendaciones Equifax</a>
          </li>	
        {%endif%}
        {%if estado != 'Cancel' and estado != 'Cancelado' %}
            <li>
                <a class="listado_ac_tablas" href="{{ path('infopunto_new',{ 'idCli': entity.id, 'idPer': idper,'rol': 'Cliente' }) }}">Nuevo Punto</a>
            </li>
            <li>
                <a class="listado_ac_tablas" href="{{ path('contacto_new') }}">Nuevo Contacto</a>
            </li>				
            {% if(contrato is not null) %}
                <li>
                    <a class="listado_ac_tablas" href="{{ path('cliente_show_datos_comerciales',{ 'idper': idper }) }}">Datos Comerciales</a>
                </li>
            {%endif%}
        <li>
            <a class="listado_ac_tablas" href="{{ path('cliente_show_agregar_padre_facturacion', { 'id': entity.id,'idper':idper }) }}">Agregar Padres Facturacion</a>
        </li>
        {%if (is_granted("ROLE_9-3757") and prefijoEmpresa == 'TN') %}
        <li>
            <a class="listado_ac_tablas" href="{{ path('cliente_show_asignar_ejecutivo_cobranzas', { 'id': entity.id,'idper':idper }) }}">
                Asignar Ejecutivo Cobranzas
            </a>
        </li>
        {%endif%}
        {%if (is_granted("ROLE_151-3738") and prefijoEmpresa == 'TN' and esVip == 'Sí' )  %}
         <li>
             <a class="listado_ac_tablas" href="{{ path('cliente_show_asignar_ingeniero_VIP', 
                                                       {'intIdPersona': entity.id, 'intIdPersonaEmpresaRol':idper })}}">Asignar Ingeniero(s) VIP
             </a>
         </li>
        {%endif%} 
        {%if (is_granted("ROLE_151-6417") and prefijoEmpresa == 'TN') %}
        <li>
            <a class="listado_ac_tablas" href="{{ path('cliente_showCorteReactivacionTelcohome', { 'intIdPersona': entity.id,'intIdPer':idper }) }}">
                Suspensi&oacute;n&#47;Reactivaci&oacute;n Masiva TelcoHome
            </a>
        </li>
        {%endif%}
        {%endif%}
        {%if (is_granted("ROLE_151-7337") and prefijoEmpresa == 'TN') %}
        <li>
            <a class="listado_ac_tablas" href="{{ path('cliente_generarCorteMasivoTN') }}">
                Generar Corte Masivo
            </a>
        </li>
        {%endif%}
        {%if (is_granted("ROLE_151-7357") and prefijoEmpresa == 'TN') %}
        <li>
            <a class="listado_ac_tablas" href="{{ path('cliente_generarReactivarMasivoTN') }}">
                Generar Reactivaci&oacute;n Masiva
            </a>
        </li>
        {%endif%}
        {%if((prefijoEmpresa =='MD' or prefijoEmpresa == 'EN' )and entity.tipoTributario == 'JUR') %}
            <li>
                <a class="listado_ac_tablas" href="javascript:void(0)"  onclick="gestorRepresentanteLegal('modal','{{entity.tipoIdentificacion}}','{{entity.identificacionCliente}}',{{ esCoordinadorMD }})">
                    Ver representante legal
                </a>
            </li>
        {%endif%}
        {%if(is_granted("ROLE_486-1") and (prefijoEmpresa =='MD' or prefijoEmpresa == 'EN' )) %}
            <li>
                <a class="listado_ac_tablas" href="{{path('admiDocEnunciadoResp',{'identificacionCliente':entity.identificacionCliente})}}">Ver Políticas y Cláusulas</a>
            </li>  
        {%endif%}       
    </ul>	
{% endblock contenido_der %}

{% block javascripts_footer%}
<script src="{{ asset('public/js/jquery-tooltip/jquery.tooltip.js') }}" type="text/javascript"></script>
<script>
var url_total_ptos="{{ path('infopunto_ajax_gettotalptos',{'id':entity.id}) }}";
var url_total_ctos="{{ path('cliente_ajax_gettotalcontactos',{'id':entity.id}) }}";
var url_contrato="{{ path('infocontrato_ajax_getcontratocliente',{'id':entity.id}) }}";
//Hace referencia al controlador que retorna los tipos de negocios
var url_lista_tiposNegocios= '{{ path('cliente_lista_tiposNegocios') }}';
//Hace referencia al controlador que actualiza el tipo de negocio
var url_cambiaTipoNegocio = '{{ path('cliente_cambiaTipoNegocio') }}';
//Contiene el valor de verdadero si el usuario tiene el perfil de cambio de tipo de negocio
var puedeCambiarTipoNegocio = '{{ is_granted("ROLE_151-1477") }}';
//Contiene el tipo de negocio Actual
var url_tipoNegocioActual = '{{ path('cliente_tipoNegocioActual') }}';
</script>
<script>
Ext.require([
    '*'
]);    
Ext.onReady(function(){

//JS para flujo de Ptos. Cliente
    Ext.define('ListaDetalleModel', {
        extend: 'Ext.data.Model',
        fields: [{name:'total', type: 'int'}
                ]
    }); 

    store = Ext.create('Ext.data.JsonStore', {
        model: 'ListaDetalleModel',
        proxy: {
            type: 'ajax',
            url: url_total_ptos,
            reader: {
                type: 'json',
                root: 'total_ptos'
            }
        },
        listeners: {
            load: function(store){
                store.each(function(record) {
                    var items="<tr><td colspan='2' style='padding:6px;'><h1>Flujo de Punto Cliente</h1></td></tr>";
                    if(record.data.total > 0)
                    {
                        $("#img_flujo_ptoscliente").attr("src","{{ asset('public/images/ptos_cliente_verde.png') }}");
                        items=items+"<tr><td style='padding:6px;'><img width='18' height='18' src='{{ asset('public/images/check.png') }}'></td><td  style='padding:6px;'>Tiene al menos 1 punto cliente ingresado.</td></tr>";                      
                    }
                    else
                    {
        		$("#img_flujo_ptoscliente").attr("src","{{ asset('public/images/ptos_cliente_gris.png') }}");
                	items=items+"<tr><td style='padding:6px;'><img width='18' height='18' src='{{ asset('public/images/delete.png') }}'></td><td  style='padding:6px;'>No tiene puntos cliente ingresados en el cliente.</td></tr>";                    
                    }
                    $("#flujo-ptoscliente").attr("title",
                    "<div><table>"+items+"</table></div>");
                    $('#flujo-ptoscliente').tooltip({
                    track: true,
                    delay: 0,
                    showURL: false,
                    showBody: " - ",
                    extraClass: "pretty",
                    fixPNG: true,
                    left: -6
                    });                    
                });
            }
        }
    });

    store.load();  

//JS para flujo de contactos
    storeCtos = Ext.create('Ext.data.JsonStore', {
        model: 'ListaDetalleModel',
        proxy: {
            type: 'ajax',
            url: url_total_ctos,
            reader: {
                type: 'json',
                root: 'total_ctos'
            }
        },
        listeners: {
            load: function(store){
                store.each(function(record) {
                    var items="<tr><td colspan='2' style='padding:6px;'><h1>Flujo de Contactos</h1></td></tr>";
                    if(record.data.total > 0)
                    {
                        $("#img_flujo_contactos").attr("src","{{ asset('public/images/address_book_verde.png') }}");
                        items=items+"<tr><td style='padding:6px;'><img width='18' height='18' src='{{ asset('public/images/check.png') }}'></td><td  style='padding:6px;'>Tiene al menos 1 contacto ingresado.</td></tr>";                      
                    }
                    else
                    {
        		$("#img_flujo_contactos").attr("src","{{ asset('public/images/address_book_gris.png') }}");
                	items=items+"<tr><td style='padding:6px;'><img width='18' height='18' src='{{ asset('public/images/delete.png') }}'></td><td  style='padding:6px;'>No tiene contactos ingresados en el cliente.</td></tr>";                    
                    }
                    $("#flujo-contactos").attr("title",
                    "<div><table>"+items+"</table></div>");
                    $('#flujo-contactos').tooltip({
                    track: true,
                    delay: 0,
                    showURL: false,
                    showBody: " - ",
                    extraClass: "pretty",
                    fixPNG: true,
                    left: -6
                    });                    
                });
            }
        }
    });

    storeCtos.load();  


//JS para flujo de contrato
    Ext.define('contratoModel', {
        extend: 'Ext.data.Model',
        fields: [{name:'tiene', type: 'string'},
                {name:'numero', type: 'string'},
                {name:'estado', type: 'string'}
                ]
    }); 

    storeContrato = Ext.create('Ext.data.JsonStore', {
        model: 'contratoModel',
        proxy: {
            type: 'ajax',
            url: url_contrato,
            reader: {
                type: 'json',
                root: 'contrato'
            }
        },
        listeners: {
            load: function(store){
                store.each(function(record) {
                    var items="<tr><td colspan='2' style='padding:6px;'><h1>Flujo de Contrato</h1></td></tr>";
                    if(record.data.tiene == 'si')
                    {
                        //si estado es activo
                        if (record.data.estado=='Activo'){
                            $("#img_flujo_contrato").attr("src","{{ asset('public/images/com-contrato_verde.png') }}");
                            items=items+"<tr><td style='padding:6px;'><img width='18' height='18' src='{{ asset('public/images/check.png') }}'></td><td  style='padding:6px;'>Ya tiene ingresado el contrato y ya esta aprobado.</td></tr>";
                        }
                        //si estado es inactivo
                        if (record.data.estado=='Inactivo'){
                            $("#img_flujo_contrato").attr("src","{{ asset('public/images/com-contrato_amarillo.png') }}");
                            items=items+"<tr><td style='padding:6px;'><img width='18' height='18' src='{{ asset('public/images/delete.png') }}'></td><td  style='padding:6px;'>Ya tiene ingresado el contrato, pero esta inactivo.</td></tr>";
                        }                            
                        //si estado esta pendiente
                        if (record.data.estado=='Pendiente'){
                            $("#img_flujo_contrato").attr("src","{{ asset('public/images/com-contrato_amarillo.png') }}");
                            items=items+"<tr><td style='padding:6px;'><img width='18' height='18' src='{{ asset('public/images/delete.png') }}'></td><td  style='padding:6px;'>Ya tiene ingresado el contrato, pero aun no es aprobado.</td></tr>";
                        }                            
                    }
                    else
                    {
        		$("#img_flujo_contrato").attr("src","{{ asset('public/images/com-contrato_gris.png') }}");
                	items=items+"<tr><td style='padding:6px;'><img width='18' height='18' src='{{ asset('public/images/delete.png') }}'></td><td  style='padding:6px;'>Aun no tiene ingresado un contrato.</td></tr>";                    
                    }
                    $("#flujo-contrato").attr("title",
                    "<div><table>"+items+"</table></div>");
                    $('#flujo-contrato').tooltip({
                    track: true,
                    delay: 0,
                    showURL: false,
                    showBody: " - ",
                    extraClass: "pretty",
                    fixPNG: true,
                    left: -6
                    });                    
                });
            }
        }
    });

    storeContrato.load();  
});    
</script>    
        
{% endblock javascripts_footer%}
